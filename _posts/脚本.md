---
title: m站脚本优化
comments: true
tags:
  - 技术
  - 浏览器
categories: 技术
abbrlink: 369a5662
date:
updated:
---
非常普通的一天,想打开电脑看看动漫
打开叔叔的b站却发现自己不是大会员,无奈只能打开了[m站](https://www.bimiacg4.net/)
一直以来运行困难但仍然不倒的良心视频站,但却有点小广告
就随手去油猴找了个去广告的优化小脚本
可脚本久未更新,已经失效,无奈只好自行修改<!--more-->
以下是修改前的代码,借着这个也稍稍讲解一下简单的tampermonkey即油猴脚本的编写

```javascript
// ==UserScript==
// @name         M站优化
// @namespace    https://github.com/HaoNShi/Tampermonkey_Scripts
// @version      1.6
// @icon         http://www.bimiacg2.net/favicon.ico
// @description  bimi动漫去广告以及其他一系列优化
// @author       HaoNShi
// @match        *://*.bimiacg4.net/*
// @grant        none
// ==/UserScript==
(function () {
    'use strict';

    // 去广告
    setTimeout(function () {
        $("#HMRichBox").remove(); // 右下角广告
        $("#HMcoupletDivleft").remove(); // 右下角广告
        $("#HMcoupletDivright").remove(); // 右下角广告
    }, 500);
    $(".tuiguang").remove();

    // 允许选中和右键
    document.oncontextmenu = function () {
        return true;
    };
    document.onselectstart = function () {
        return true;
    };

    // 还原鼠标样式
    document.body.style.cursor = "default";
    $("a").hover(function () {
        $("a").css("cursor", "pointer");
    })

    // 删除伪搜索历史框
    $(".search-history").remove();

    // 调整播放页的导航栏和关灯按钮的层级
    $(".wrapper > ul > li > ul").css("z-index", "999");

    // 对齐提示条
    $("div[style]").each(function () {
        if ($(this).css("width") === "1155px") {
            $(this).css("margin-left", "0px");
            $(this).css("width", "1190px");
        }
    })

})();
```

之前已经介绍过油猴的安装,详情请看[这期](/posts/e3d61257/)
新建一个脚本只需点击油猴图标,点击添加新脚本即可
而油猴脚本的代码构成其实很简单
开头的UserScript部分只是说明部分,即代码头,这部分编辑器会自动输入,只需修改即可
其中注明了脚本名称 网址 版本 说明 作者等等,其中icon项是脚本图标需要注意一下,另外就是match项,用来匹配生效的网站,输入网址即可,可以同时拥有多个目标,下面的function即主函数部分,将js脚本内容直接写进去即可
通过调试我发现脚本的问题是我的网页加载速度实际上并不足以在500毫秒内进入网站,所以settimeout中的内容在网页加载完成后没有得到执行,因此广告还在,同时脚本里去除的并非全部广告,所以我自己增添了几条

```javascript
$("#HMrichA").remove();
```

这部分代码的内容就是remove掉id为HMrichA的项
如果要remove名为tuiguang的class则需使用.tuiguang
为什么使用#和.涉及到css选择器知识,此处不赘述,知道以上这些就已经足以去除广告了
广告的id或class获取可以通过右键广告选择检查或者检查元素的方式,主流浏览器应该都有这个功能,然后会打开类似这个的窗口
![演示](/images/class例子.png)
找到其中属于广告的那一条然后记下class后的名字即可
有些无法右键的网站可以自己打开开发人员工具逐层寻找
按以上方法修改一下就变成了这样,测试可用,可以直接复制使用

```javascript
// ==UserScript==
// @name         M站优化
// @namespace    https://github.com/HaoNShi/Tampermonkey_Scripts
// @version      1.6
// @icon         http://www.bimiacg2.net/favicon.ico
// @description  bimi动漫去广告以及其他一系列优化
// @author       HaoNShi
// @match        *://*.bimiacg4.net/*
// @grant        none
// ==/UserScript==
(function () {
    'use strict';

    // 去广告
    setTimeout(function () {
        $("#HMRichBox").remove(); // 右下角广告
        $("#HMcoupletDivleft").remove(); // 右下角广告
        $("#HMcoupletDivright").remove(); // 右下角广告
        $("#HMimageright").remove();//右侧广告
        $("#HMimageleft").remove();//左侧广告
        $("#HMrichA").remove();//右下角广告
    }, 1500);
    $(".tuiguang").remove();

    // 允许选中和右键
    document.oncontextmenu = function () {
        return true;
    };
    document.onselectstart = function () {
        return true;
    };

    // 还原鼠标样式
    document.body.style.cursor = "default";
    $("a").hover(function () {
        $("a").css("cursor", "pointer");
    })

    // 删除伪搜索历史框
    $(".search-history").remove();

    // 调整播放页的导航栏和关灯按钮的层级
    $(".wrapper > ul > li > ul").css("z-index", "999");

    // 对齐提示条
    $("div[style]").each(function () {
        if ($(this).css("width") === "1155px") {
            $(this).css("margin-left", "0px");
            $(this).css("width", "1190px");
        }
    })

})();
```
